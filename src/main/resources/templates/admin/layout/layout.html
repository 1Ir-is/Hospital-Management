<!DOCTYPE html>
<html lang="vi"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
>
<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Dashboard - Quản lý Bệnh viện Codegym</title>
    <script src="https://kit.fontawesome.com/c1df782baf.js"></script>
    <link href="/css/admin.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<!-- Header -->
<header class="admin-header">
    <div class="header-content">
        <div class="admin-logo">
            <i class="fas fa-hospital"></i>
            <span>Admin Panel - Codegym Hospital</span>
        </div>
        <div class="admin-nav">
            <div class="user-info">
                <div class="user-avatar">A</div>
                <span>Admin User</span>
            </div>
            <a class="logout-btn" href="#">
                <i class="fas fa-sign-out-alt"></i>
                Đăng xuất
            </a>
        </div>
    </div>
</header>

<div class="admin-container">
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-menu">
            <div class="menu-section">
                <div class="menu-title">Tổng quan</div>
                <a class="menu-item" href="/admin" th:classappend="${activeMenu} == 'dashboard' ? 'active' : ''">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-title">Quản lý y tế</div>
                <a class="menu-item" href="/admin/departments"
                   th:classappend="${activeMenu} == 'departments' ? 'active' : ''">
                    <i class="fas fa-building"></i>
                    <span>Khoa bệnh viện</span>
                </a>
                <a class="menu-item" href="/admin/doctors"
                   th:classappend="${activeMenu} == 'doctors' ? 'active' : ''">
                    <i class="fas fa-user-md"></i>
                    <span>Bác sĩ</span>
                </a>
                <a class="menu-item" href="/admin/patients"
                   th:classappend="${activeMenu} == 'patients' ? 'active' : ''">
                    <i class="fas fa-users"></i>
                    <span>Bệnh nhân</span>
                </a>
                <a class="menu-item" href="/admin/appointments"
                   th:classappend="${activeMenu} == 'appointments' ? 'active' : ''">
                    <i class="fas fa-calendar-check"></i>
                    <span>Lịch hẹn</span>
                </a>
                <a class="menu-item" href="/admin/rooms"
                   th:classappend="${activeMenu} == 'rooms' ? 'active' : ''">
                    <i class="fas fa-bed"></i>
                    <span>Phòng bệnh</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-title">Quản lý nhân sự</div>
                <a class="menu-item" href="/admin/employees"
                   th:classappend="${activeMenu} == 'employees' ? 'active' : ''">
                    <i class="fas fa-user-tie"></i>
                    <span>Nhân viên</span>
                </a>
                <a class="menu-item" href="/admin/roles"
                   th:classappend="${activeMenu} == 'roles' ? 'active' : ''">
                    <i class="fas fa-user-shield"></i>
                    <span>Vai trò</span>
                </a>
                <a class="menu-item" href="/admin/positions"
                   th:classappend="${activeMenu} == 'positions' ? 'active' : ''">
                    <i class="fas fa-briefcase"></i>
                    <span>Chức vụ</span>
                </a>
            </div>

            <div class="menu-section">
                <div class="menu-title">Hệ thống</div>
                <a class="menu-item" href="/admin/settings"
                   th:classappend="${activeMenu} == 'settings' ? 'active' : ''">
                    <i class="fas fa-cog"></i>
                    <span>Cài đặt</span>
                </a>
                <a class="menu-item" href="/admin/reports"
                   th:classappend="${activeMenu} == 'reports' ? 'active' : ''">
                    <i class="fas fa-chart-bar"></i>
                    <span>Báo cáo</span>
                </a>
                <a class="menu-item" href="/admin/security"
                   th:classappend="${activeMenu} == 'security' ? 'active' : ''">
                    <i class="fas fa-shield-alt"></i>
                    <span>Bảo mật</span>
                </a>
                <a class="menu-item" href="/admin/audit"
                   th:classappend="${activeMenu} == 'audit' ? 'active' : ''">
                    <i class="fas fa-history"></i>
                    <span>Nhật ký hoạt động</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div layout:fragment="main-content"></div>
    </main>
</div>

<!-- Base JavaScript -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Sidebar menu interactions
        const menuItems = document.querySelectorAll(".menu-item");
        const currentPath = window.location.pathname;

        // ✅ KHÔNG XỬ LÝ ACTIVE NỮA VÌ THYMELEAF ĐÃ XỬ LÝ
        // Chỉ xử lý click interactions
        menuItems.forEach((item) => {
            item.addEventListener("click", function (e) {
                // Không remove active nữa - để Thymeleaf xử lý
                // menuItems.forEach((mi) => mi.classList.remove("active"));
                // this.classList.add("active");

                // Chỉ add loading effect nếu cần
                this.style.opacity = "0.7";
            });
        });

        // Mobile menu toggle (if needed)
        const toggleSidebar = document.querySelector(".sidebar-toggle");
        const sidebar = document.querySelector(".sidebar");

        if (toggleSidebar) {
            toggleSidebar.addEventListener("click", function () {
                sidebar.classList.toggle("collapsed");
            });
        }

        // Logout confirmation
        const logoutBtn = document.querySelector(".logout-btn");
        if (logoutBtn) {
            logoutBtn.addEventListener("click", function (e) {
                e.preventDefault();
                if (confirm("Bạn có chắc chắn muốn đăng xuất?")) {
                    window.location.href = "/admin/logout";
                }
            });
        }

        // Auto-close mobile menu when clicking outside
        document.addEventListener("click", function (e) {
            if (window.innerWidth <= 768) {
                const sidebar = document.querySelector(".sidebar");
                const sidebarToggle = document.querySelector(".sidebar-toggle");

                if (sidebar && !sidebar.contains(e.target) && !sidebarToggle?.contains(e.target)) {
                    sidebar.classList.remove("active");
                }
            }
        });

        // Responsive sidebar handling
        function handleResize() {
            const sidebar = document.querySelector(".sidebar");
            if (window.innerWidth > 768) {
                sidebar?.classList.remove("active");
            }
        }

        window.addEventListener("resize", handleResize);
        handleResize(); // Call on initial load
    });
</script>

<!-- Các JS library -->
<script src="https://kit.fontawesome.com/c1df782baf.js"></script>
<!-- Placeholder cho script riêng của từng page -->
<div layout:fragment="page-scripts"></div>
</body>
</html>