<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Danh s√°ch b·ªánh nh√¢n n·ªôi tr√∫</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
  <h2 class="mb-4">Danh s√°ch b·ªánh nh√¢n n·ªôi tr√∫</h2>
  <form th:action="@{/department-head/list-inpatient}" method="get" class="row mb-3">
    <input type="hidden" name="departmentId" th:value="${departmentId}"/>
    <div class="col-md-3">
      <input type="text" name="patientName" class="form-control" placeholder="T√™n b·ªánh nh√¢n"
             th:value="${patientName}">
    </div>
    <div class="col-md-3">
      <input type="text" name="roomNumber" class="form-control" placeholder="S·ªë ph√≤ng"
             th:value="${roomNumber}">
    </div>
    <div class="col-md-3">
      <input type="text" name="doctorName" class="form-control" placeholder="T√™n b√°c sƒ© ƒëi·ªÅu tr·ªã"
             th:value="${doctorName}">
    </div>
    <div class="col-md-3">
      <input type="text" name="nurseName" class="form-control" placeholder="T√™n ƒëi·ªÅu d∆∞·ª°ng"
             th:value="${nurseName}">
    </div>

    <div class="col-md-3">
      <button type="submit" class="btn btn-primary w-100">T√¨m ki·∫øm</button>
    </div>
  </form>






  <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert" id="alertSuccess">
    <span th:text="${success}"></span>
  </div>


  <table class="table table-bordered table-hover">
    <thead class="table-light">
    <tr>
      <th>T√™n b·ªánh nh√¢n</th>
      <th>Gi·ªõi t√≠nh</th>
      <th>Ng√†y sinh</th>
      <th>Ph√≤ng</th>
      <th>Ng√†y nh·∫≠p vi·ªán</th>
      <th>Tr·∫°ng th√°i</th>
      <th>B√°c sƒ© ƒëi·ªÅu tr·ªã</th>
      <th>ƒêi·ªÅu d∆∞·ª°ng ph·ª• tr√°ch</th>
      <th>H√†nh ƒë·ªông</th>


    </tr>
    </thead>
    <tbody>
    <tr th:each="r : ${recordList}">
      <td th:text="${r.medicalRecord.patient.name}">T√™n</td>
      <td th:text="${r.medicalRecord.patient.gender} ? 'Nam' : 'N·ªØ'">Gi·ªõi t√≠nh</td>
      <td th:text="${r.medicalRecord.patient.birthday}">1990-01-01</td>
      <td th:text="${r.medicalRecord.room.number}">101</td>
      <td th:text="${#temporals.format(r.admissionDate, 'dd-MM-yyyy')}"></td>
      <td>
        <span class="badge bg-success">ƒêang ƒëi·ªÅu tr·ªã</span>
      </td>
      <td th:text="${r.assignedDoctor != null ? r.assignedDoctor.name : 'Ch∆∞a ph√¢n c√¥ng'}">T√™n b√°c sƒ©</td>
      <td th:text="${r.assignedNurse != null ? r.assignedNurse.name : 'Ch∆∞a ph√¢n c√¥ng'}">T√™n ƒëi·ªÅu d∆∞·ª°ng</td>
      <td>
        <div class="d-flex gap-1">
        <a th:href="@{/department-head/inpatient/detail(recordId=${r.id})}"
           class="btn btn-sm btn-info" title="Xem chi ti·∫øt b·ªánh nh√¢n">
          Chi ti·∫øt
        </a>

        <a th:if="${r.assignedDoctor == null}"
           th:href="@{/department-head/doctors/assign-form(recordId=${r.id}, departmentId=${departmentId})}"
           class="btn btn-sm btn-primary"
           title="Ph√¢n c√¥ng b√°c sƒ© ƒëi·ªÅu tr·ªã">Ph√¢n c√¥ng</a>

        <form th:if="${r.assignedDoctor != null}"
              th:action="@{/department-head/doctors/assign-form}" method="get">
          <input type="hidden" name="recordId" th:value="${r.id}">
          <input type="hidden" name="departmentId" th:value="${departmentId}"> <!-- üëà TH√äM -->
          <button type="submit" class="btn btn-sm btn-warning">Ch·ªânh s·ª≠a</button>
        </form>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</div>
<a th:href="@{/department-head(departmentId=${departmentId})}" class="btn btn-secondary mb-3">
  ‚Üê Quay l·∫°i danh s√°ch nh√¢n vi√™n
</a>
<div class="d-flex justify-content-center align-items-center mt-4">
  <a th:if="${recordPage.hasPrevious()}"
     th:href="@{/department-head/list-inpatient(page=${recordPage.number - 1},
                                               size=${recordPage.size},
                                               patientName=${patientName},
                                               roomNumber=${roomNumber},
                                               doctorName=${doctorName},
                                               nurseName=${nurseName},
                                               departmentId=${departmentId})}"
     class="btn btn-outline-secondary me-2">Tr∆∞·ªõc</a>

  <!-- S·ªë trang -->
  <span class="me-2">
    Trang <span th:text="${recordPage.number + 1}"></span> / <span th:text="${recordPage.totalPages}"></span>
</span>

  <a th:if="${recordPage.hasNext()}"
     th:href="@{/department-head/list-inpatient(page=${recordPage.number + 1},
                                               size=${recordPage.size},
                                               patientName=${patientName},
                                               roomNumber=${roomNumber},
                                               doctorName=${doctorName},
                                               nurseName=${nurseName},
                                               departmentId=${departmentId})}"
     class="btn btn-outline-secondary">Sau</a>

</div>

<script>
  setTimeout(function () {
    const alert = document.getElementById('alertSuccess');
    if (alert) {
      alert.classList.remove('show');
      alert.classList.add('d-none');
    }
  }, 3000); // 3 gi√¢y
</script>

</body>
</html>
